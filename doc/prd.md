# prd

mara是一个用于股票数据分析的python命令行工具。

## Product Requirements

1. 通过cli命令行方式与用户交互。cli的命令行参数行为见下文。

2. 数据来源于tushare，且用户应当具备pro token。token的读取通过~/.mararc文件实现，文件格式为yaml，内容示例如下：

```yaml
token: <your_tushare_pro_token>
```

3. 应支持全部可以通过tushare直接查询的指标，如PE、PB、ROE等。（关于tushare有哪些数据，可以从tushare官网获得）

4. 用户也可以方便的通过编写py模块，扩展mara的功能，可以编写一个新的模块来计算某个自定义指标。

5. 用户通过参数输入待查询的股票列表，可以是多个股票代码，也可以是某个行业的全部股票。

6. 运行程序后，程序在stdout上输出指标结果，第一行为标题（也可以通过参数控制不输出），第一列为股票代码，后续列跟basic接口查询的基本信息（名称等一系列信息），再后续列为通过参数指定的指标数值（可以同时指定多个指标）。从第二行开始为对应的数据。分割符可通过参数设置（例，空格、逗号）

7. 用户可以通过参数控制，以输出以下几种指标数据内容：

    - 某一个或多个指标按时间的数据，时间序列值

    - 某一个或多个指标全部某一季数据（例如，全部Q1），时间序列值

    - 某一个或多个指标最新数据，单值

    - 某一个或多个指标全部某一季数据（例如，全部Q1）的平均值或中位值，单值

8. 支持对于一、二、三、四季的季度财报数据值，支持两种数据，一种是季报的原始值（即累计值），另一种是单季值（即非累计值）。用户可以通过参数控制选择哪一种数据。

9. 用户可以通过参数控制，指定数据的时间范围，例如从某年某月某日到某年某月某日。如未指定，则默认为2020年1月1日至今。

10. 用户可以通过参数控制，指定输出的排序方式，例如按某个指标升序或降序排列输出结果。这里仅支持单值的排序。

12. 用户可以将上述数据导出为Excel xlsx文件。

13. 用户可以通过matplotlib对输出的指标进行可视化。当用户指定了多个指标时，可以生成多个子图。

14. 数据源接口尽量插件化，方便将来引入其他数据源。（现在可以没有）

## cli arguments

```plaintext
mara [OPTIONS] [KEYWORD ...]
```

- `KEYWORD ...`：可选参数，指定要分析的股票代码列表。这里的股票代码，应当接受中文的股票名称、拼音缩写、股票代码等多种形式的输入。还有一种情况，是直接输入行业名称，此时查询的即为该行业的全部股票。

- `-i, --indicators TEXT`：必选参数，指定要查询的指标，可以是一个或多个指标名称，多个名称之间用逗号分隔。

- `-s, --start-date TEXT`：可选参数，指定查询的起始日期，格式为YYYY-MM-DD。

- `-e, --end-date TEXT`：可选参数，指定查询的结束日期，格式为YYYY-MM-DD。

- `--season INTEGER`：可选参数，指定查询的季度（1-4，0表示所有季度）。默认为第四季度，即年报数据。

- `--single`：可选参数，指定查询季度数据时，获取单季值（非累计值）。默认获取累计值。

- `--latest`：可选参数，指定查询最新数据。

- `--aggregate TEXT`：可选参数，指定对季度数据进行的聚合操作，可以是"mean"（平均值）或"median"（中位值）。

- `-t, --sort-by TEXT`：可选参数，指定排序的指标名称。

- `--sort-order TEXT`：可选参数，指定排序的顺序，可以是"asc"（升序）或"desc"（降序）。默认为"asc"。

- `-v, --verbose TEXT`：可选参数，指定日志输出级别（error、warn、info、debug），默认warn。日志输出到stderr。

- `-x, --excel TEXT`：可选参数，指定输出的Excel文件路径。

- `--no-header`：可选参数，指定不输出标题行。

- `--delimiter TEXT`：可选参数，指定输出的分割符，默认为逗号。

- `-p, --plot`：可选参数，指定对输出的指标进行可视化。

- `-c, --config TEXT`：可选参数，指定配置文件路径，默认为~/.mararc。

- `-h, --help`：显示帮助信息并退出。

- `--version`：显示版本信息并退出。

- `--debug`：启用调试模式，输出更多的调试信息（等同于verbose=debug）。
